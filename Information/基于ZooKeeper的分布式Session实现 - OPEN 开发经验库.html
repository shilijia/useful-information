<!DOCTYPE html>
<!-- saved from url=(0056)http://www.open-open.com/lib/view/open1378556537303.html -->
<html><head lang="cn"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title> 基于ZooKeeper的分布式Session实现 - OPEN 开发经验库</title>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="ZooKeeper,分布式/云计算">
	<meta name="description" content="ZooKeeper—— “动物园管理员”。动物园里当然有好多的动物，游客可以根据动物园提供的向导图到不同的场馆观赏各种类型的动物，而不是像走在原始丛林里，心惊胆颤的被动 物所观赏。为了让各种不同的动物呆在它们应该呆的地方，而不是相互串门，或是相互厮杀，就需要动物园管理员按照动物的各种习性加以分类和管理，这样我们才 能更加放心安全的观赏动物。回到我们企业级应用系统中，随着信息化水平的不断提高，我们的企业级系统变得越来越庞大臃肿，性能急剧下降，客户抱怨频频。拆 分系统是目前我们可选择的解决系统可伸缩性和性能问题的唯一行之有效的方法。">
	<link rel="shortcut icon" href="http://www.open-open.com/lib/favicon.ico">
	<link rel="copyright" href="http://www.open-open.com/">

	<link href="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/idea.min.css" rel="stylesheet">
	<link href="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/jquery-ui.min.css" rel="stylesheet">
	
	<link href="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/bootstrap.min.css" rel="stylesheet">
	<link href="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/font-awesome.min.css" rel="stylesheet">
	<link href="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/jquery-confirm.css" rel="stylesheet">
	<link href="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/styles.css" rel="stylesheet">

	<style type="text/css" media="screen, projection">
		/*<![CDATA[*/
		@import "/lib/css/common.css";
		@import "/lib/css/main.css";
		@import "/lib/css/jGrowl.css";
		/*]]>*/
		.articleIndex li.active a {
			color: #0099ff;
		}
	</style>
	<style type="text/css">
		.topheader h1{font-size: 24px;margin: 0;}
		.crumbs{padding-bottom: 5px;font-size: 11px;}.crumbs,.crumbs a,.meta{color: #bbb;}
		#tag-list{margin-top: 10px;}
		#tag-list a{background: #fff;padding: 2px 10px;text-decoration: none;}
		#tag-list a:hover{background: #c5e2ff;color: #0099ff;}
		.crumbs a:hover{color: #0099ff;}
		#readercontainer{background: #fff;padding: 40px 89px;}

		.post-nav ul{
			margin: 0;
		}
		.post-nav>ul>li a{
			padding-left: 10px;
		}
		.post-nav>ul>li>ul>li a{
			padding-left: 30px;
		}
		.post-nav>ul>li>ul>li>ul>li a{
			padding-left: 50px;
		}
		.post-nav ul li.active a{
			border-left: 2px solid #0099ff;
		}

		.aside-fixed {
			left: 50%;
			margin-left: 310px;
			position: fixed;
			top: 65px;
			width: 260px;
		}
		.bdsharebuttonbox {
			background: #eee none repeat scroll 0 0;
			margin-top: 10px;
			padding: 10px;
			width: 100%;
		}

	</style>

	<script src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/push.js.下载"></script><script type="text/javascript">
		if(window.location.toString().indexOf('pref=padindex') != -1){
		}else{
			if(/AppleWebKit.*Mobile/i.test(navigator.userAgent) || (/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(navigator.userAgent))){
				if(window.location.href.indexOf("?mobile")<0){
					try{
						if(/Android|Windows Phone|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)){
							window.location.href="http://m.open-open.com/m/lib/view/1378556537303.html";
						}else if(/iPad/i.test(navigator.userAgent)){
							window.location.href="http://m.open-open.com/m/lib/view/1378556537303.html"
						}else{
							window.location.href="http://m.open-open.com/m/lib/view/1378556537303.html"
						}
					}catch(e){}
				}
			}
		}
	</script>


	<script type="text/javascript">
		var rooturl="/lib";
		var wgDocKey='1378556537303';
		var wgDocTitle=' 基于ZooKeeper的分布式Session实现';
		var wgDocStatusFlag='';
		var wgUserFolders=null;
		var wgDownFrame=null;
		var wgCostByUser=null;
		var wgDocFavoriteByUser=false;
		var wgDocScoreByUser=null;
		var wgUserLogined=0;
		var tb_pathToImage = "/lib/images/loadingAnimation.gif";


	</script>




<script src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/share.js.下载"></script><link rel="stylesheet" href="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/share_style0_16.css"></head>
<body id="view"><div id="BAIDU_DUP_fp_wrapper" style="position: absolute; left: -1px; bottom: -1px; z-index: 0; width: 0px; height: 0px; overflow: hidden; visibility: hidden; display: none;"><iframe id="BAIDU_DUP_fp_iframe" src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/o.html" style="width: 0px; height: 0px; visibility: hidden; display: none;"></iframe></div>


<style>
	.global-tags{background: #333;color: #ababab;height: 30px;line-height: 30px;width: 100%;}
	.global-tags .container{position: relative;}
	.global-tags ul{ height: 30px; margin: 0; overflow: hidden;}
	.global-tags a{color:#ababab;padding: 5px; }
	.global-tags a:hover{color:#e0e0e0; }
	.global-tags li { display: inline-block; padding: 0; }
	.global-tags  .more { background-color: #333; height: 30px; position: absolute; right: 0; top: 0; width: 30px; }
	.global-tags  .more:before { background-image: linear-gradient(90deg, rgba(0, 95, 60, 0), #333); background-size: 100% auto; content: ""; height: 100%; left: -20px; position: absolute; top: 0; width: 20px; }

	/* menu */
	.all-sort{z-index: 100;position: absolute;left: 15px;top: 30px;display: none;}
	.all-sort-head{background: #ff3c00; color: #fff; margin-right: 20px; text-align: center; width: 160px;float: left;}
	.all-sort-head a{color: #fff;}
	.item-list .subitem{float:left;padding:20px;}
	.all-sort-list{position:relative;width:160px;border:2px solid #393939;border-top:none;background:#393939;float: left;z-index: 100;}
	.all-sort-list .item .parent{font-weight: 700;border: none;width: 120px;text-align: right;margin-right: 2px;}
	.all-sort-list .item .parent i{font: 400 9px/14px consolas; height: 14px; margin-left: 10px; width: 4px;}
	.all-sort-list .item.bo{border-top:none;}
	.all-sort-list .item h3{height:40px;line-height:40px;font-size:14px;font-weight:normal;width:158px;overflow:hidden; color:#ffffff;margin: 0;}
	.all-sort-list .item h3 a{color: #ffffff;}
	.all-sort-list .item:hover h3,.all-sort-list .item:hover span,.all-sort-list .item:hover h3 a,.all-sort-list .item .active ,.all-sort-list .item .active a,.all-sort-list .item .active span{color:#E4393C;}
	.all-sort-list .item span{padding:0px 5px;color:#ffffff;font-family:"\5B8B\4F53";}
	.all-sort-list .item a{text-decoration:none;}
	.all-sort-list .subitem a{ float: left;  margin:5px 20px 5px 0;border-left:1px solid #eee;line-height: 14px;height: 20px;}
	.all-sort-list .item a:hover{color:#E4393C;}
	.all-sort-list .item:hover h3,.all-sort-list .item .active{position:relative;z-index:13;background:#FFF;border-color:#DDD;border-width:1px 0px;border-style:solid;}
	.all-sort-list .item-list{ display:none; position:absolute; width:705px; min-height:360px; _height:360px; background:#FFF; left:157px;  border:1px solid #DDD; top:0; z-index:10; }

</style>


<header class="site-header">
	<div class="header-top ">
		<div class="header-top-inner">
			<div class="" style="margin: 0 30px;">
				<div class="row">
					
						<div class="header-talet pull-left">
							<a href="http://www.open-open.com/">首页</a> &nbsp;
							<a class="" href="http://www.open-open.com/code/">代码</a> &nbsp;
							<a class="" href="http://www.open-open.com/doc/">文档</a> &nbsp;
							<a title="OPEN论坛频道" href="http://www.open-open.com/solution/">问答</a> &nbsp;
							<a title="OPEN资讯" class="" href="http://www.open-open.com/news/">资讯</a> &nbsp;
							<a title="OPEN经验库" class="active" href="http://www.open-open.com/lib/">经验</a> &nbsp;
							<a title="GitHub日报" class="" href="http://www.open-open.com/github/">GitHub日报</a>
							&nbsp;|&nbsp;
							<a class="active" title=" 安卓开发专栏" target="_blank" href="http://www.open-open.com/lib/list/177">安卓开发专栏</a>
							&nbsp;|&nbsp;
							<a class="active" href="http://www.open-open.com/lib/tag/%E5%BC%80%E5%8F%91%E8%80%85%E5%91%A8%E5%88%8A" target="_blank" rel="tag">开发者周刊</a>&nbsp;|&nbsp;
							<a class="active" href="http://www.open-open.com/lib/view/open1475497562965.html" target="_blank" rel="tag">Android Studio 使用推荐</a>&nbsp;|&nbsp;
							<a class="active" href="http://www.open-open.com/lib/view/open1475497355674.html" target="_blank" rel="tag">Android开发推荐</a>
							
						</div>
					
						<div class="user-info pull-right" id="Personal">
							
								<a href="http://www.open-open.com/lib/view/open1378556537303.html#" title="登录OPEN经验库" class="login">登录</a>&nbsp;&nbsp;
								<a href="http://www.open-open.com/lib/view/open1378556537303.html#" title="注册新的账号" class="register">注册</a>
							
							
						</div>
					</div>
				</div>
			</div>
		</div>
	
	<nav class="navbar ">
		<div class="container">
			<div class="navbar-header" style="margin-right: 30px;">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span aria-hidden="true" class="glyphicon glyphicon-menu-hamburger"></span>
					<span aria-hidden="true" class="glyphicon glyphicon-menu-up"></span>
				</button>
				<a class="top-logo" href="http://www.open-open.com/lib"><span>www.open-open.com/lib</span></a>
				<span style="font-size: 26px;color: #db6d4c">OPEN经验</span>
				<span style="font-size: 12px;color: #b5b5b5"></span>
			</div>

			<div class="pull-right" style="padding: 20px;">
				<button class="btn btn-info br40" id="upload" type="button">投稿</button>
			</div>
			<div id="search">
				<form onsubmit="document.charset=&#39;utf-8&#39;;" accept-charset="utf-8" method="post" action="http://www.open-open.com/lib/query" name="sf">
					<input type="hidden" value="all" name="site">
					<div class="input-group">
						<input type="text" x-webkit-speech="" placeholder="经验搜索" class="form-control" name="q" id="kw">
                      <span class="input-group-btn">
                        <button type="submit" class="btn btn-default"><i class="fa fa-search"></i></button>
                      </span>

					</div>
				</form>

				<!-- /input-group -->

			</div>

		</div>
	</nav>
	<div class="global-tags">
		<div class="container">
			<div class="all-sort-head"><a href="http://www.open-open.com/lib/list/all">全部经验分类</a>&nbsp;<i aria-hidden="true" class="fa fa-toggle-down"></i></div><div class="all-sort"><div class="all-sort-list"><div data-submenu-id="submenu1" class="item bo"><h3><span>·</span><a href="http://www.open-open.com/lib/list/1">软件开发</a></h3><div id="submenu1" class="item-list clearfix"><div class=" subitem"><a href="http://www.open-open.com/lib/list/405">VR</a><a href="http://www.open-open.com/lib/list/2">Web框架</a><a href="http://www.open-open.com/lib/list/3">GUI开发框架</a><a href="http://www.open-open.com/lib/list/4">图表/报表制作</a><a href="http://www.open-open.com/lib/list/5">搜索引擎</a><a href="http://www.open-open.com/lib/list/6">模板引擎</a><a href="http://www.open-open.com/lib/list/7">缓存组件</a><a href="http://www.open-open.com/lib/list/8">Ajax框架</a><a href="http://www.open-open.com/lib/list/9">XML操作类库</a><a href="http://www.open-open.com/lib/list/10">HTML操作类库</a><a href="http://www.open-open.com/lib/list/12">文件上传</a><a href="http://www.open-open.com/lib/list/347">3D图形处理库</a><a href="http://www.open-open.com/lib/list/14">图形/图像处理</a><a href="http://www.open-open.com/lib/list/15">常用工具包</a><a href="http://www.open-open.com/lib/list/16">JSON开发包</a><a href="http://www.open-open.com/lib/list/353">OAuth开发包</a><a href="http://www.open-open.com/lib/list/17">PDF工具包</a><a href="http://www.open-open.com/lib/list/18">Flex开发</a><a href="http://www.open-open.com/lib/list/19">Office文档处理</a><a href="http://www.open-open.com/lib/list/20">日志处理</a><a href="http://www.open-open.com/lib/list/21">网络工具包</a><a href="http://www.open-open.com/lib/list/22">多媒体处理</a><a href="http://www.open-open.com/lib/list/23">WEB服务/RPC/SOA</a><a href="http://www.open-open.com/lib/list/24">RSS/ATOM相关</a><a href="http://www.open-open.com/lib/list/25">持久层框架</a><a href="http://www.open-open.com/lib/list/26">作业调度框架</a><a href="http://www.open-open.com/lib/list/27">工作流引擎</a><a href="http://www.open-open.com/lib/list/28">业务规则引擎</a><a href="http://www.open-open.com/lib/list/29">面向方面AOP/IoC</a><a href="http://www.open-open.com/lib/list/30">JEE框架</a><a href="http://www.open-open.com/lib/list/31">安全相关</a><a href="http://www.open-open.com/lib/list/32">OpenID/单点登录SSO</a><a href="http://www.open-open.com/lib/list/34">条形码/二维码开发包</a><a href="http://www.open-open.com/lib/list/35">验证码(Captcha)</a><a href="http://www.open-open.com/lib/list/96">网络爬虫</a><a href="http://www.open-open.com/lib/list/214">OSGi</a><a href="http://www.open-open.com/lib/list/237">网络技术</a><a href="http://www.open-open.com/lib/list/324">Google相关API</a><a href="http://www.open-open.com/lib/list/328">Swing开发包</a><a href="http://www.open-open.com/lib/list/332">HTML编辑器</a><a href="http://www.open-open.com/lib/list/337" style="color:#FF3C00">JavaScript开发工具包</a><a href="http://www.open-open.com/lib/list/352">TTS/语音合成和处理</a><a href="http://www.open-open.com/lib/list/367">游戏开发</a><a href="http://www.open-open.com/lib/list/370">加密/解密软件包</a><a href="http://www.open-open.com/lib/list/374">源代码语法着色</a><a href="http://www.open-open.com/lib/list/376">WebSocket 开发</a><a href="http://www.open-open.com/lib/list/381">MathML显示与编辑</a><a href="http://www.open-open.com/lib/list/383">计算机视觉库/人脸识别</a><a href="http://www.open-open.com/lib/list/385">XML-RPC 开发</a><a href="http://www.open-open.com/lib/list/386">Markdown处理库</a><a href="http://www.open-open.com/lib/list/387">神经网络</a><a href="http://www.open-open.com/lib/list/389">多媒体播放器</a><a href="http://www.open-open.com/lib/list/391">推荐引擎</a><a href="http://www.open-open.com/lib/list/394">机器学习</a><a href="http://www.open-open.com/lib/list/401">算法</a></div><div class="cat-right"></div></div></div><div data-submenu-id="submenu2" class="item "><h3><span>·</span><a href="http://www.open-open.com/lib/list/36">开发语言与工具</a></h3><div id="submenu2" class="item-list clearfix"><div class=" subitem"><a href="http://www.open-open.com/lib/list/406">R语言</a><a href="http://www.open-open.com/lib/list/37" style="color:#FF3C00">Java开发</a><a href="http://www.open-open.com/lib/list/38">.NET开发</a><a href="http://www.open-open.com/lib/list/39">PHP开发</a><a href="http://www.open-open.com/lib/list/40">C/C++开发</a><a href="http://www.open-open.com/lib/list/42">Ruby开发</a><a href="http://www.open-open.com/lib/list/43">Python开发</a><a href="http://www.open-open.com/lib/list/148">ActionScript开发</a><a href="http://www.open-open.com/lib/list/145" style="color:#FF3C00">JavaScript开发</a><a href="http://www.open-open.com/lib/list/44">Perl开发</a><a href="http://www.open-open.com/lib/list/263">Delphi开发</a><a href="http://www.open-open.com/lib/list/243">Erlang开发</a><a href="http://www.open-open.com/lib/list/211">Google Go/Golang开发</a><a href="http://www.open-open.com/lib/list/201">Scala开发</a><a href="http://www.open-open.com/lib/list/240">Lua开发</a><a href="http://www.open-open.com/lib/list/392">Apple Swift开发</a><a href="http://www.open-open.com/lib/list/301">Objective-C开发</a><a href="http://www.open-open.com/lib/list/45">BUG跟踪管理</a><a href="http://www.open-open.com/lib/list/294">Lisp开发</a><a href="http://www.open-open.com/lib/list/46">项目构建</a><a href="http://www.open-open.com/lib/list/41">移动开发</a><a href="http://www.open-open.com/lib/list/47">单元测试</a><a href="http://www.open-open.com/lib/list/48">测试工具</a><a href="http://www.open-open.com/lib/list/49">性能测试和优化</a><a href="http://www.open-open.com/lib/list/50">程序调试</a><a href="http://www.open-open.com/lib/list/51">代码混淆和加密</a><a href="http://www.open-open.com/lib/list/52">UML/模型工具</a><a href="http://www.open-open.com/lib/list/53">安装制作</a><a href="http://www.open-open.com/lib/list/54">代码分析/审查/优化</a><a href="http://www.open-open.com/lib/list/55">前端技术</a><a href="http://www.open-open.com/lib/list/179">Eclipse开发工具</a><a href="http://www.open-open.com/lib/list/205">IntelliJ IDEA</a><a href="http://www.open-open.com/lib/list/281">NetBeans</a><a href="http://www.open-open.com/lib/list/349">程序文档工具</a><a href="http://www.open-open.com/lib/list/361">语法/词法分析器</a><a href="http://www.open-open.com/lib/list/362">脚本/动态语言</a><a href="http://www.open-open.com/lib/list/364">持续集成系统</a><a href="http://www.open-open.com/lib/list/375">Web开发工具</a><a href="http://www.open-open.com/lib/list/388">Node.js 开发</a><a href="http://www.open-open.com/lib/list/395">中文分词</a><a href="http://www.open-open.com/lib/list/399" style="color:#FF3C00">Android Studio开发工具</a></div><div class="cat-right"></div></div></div><div data-submenu-id="submenu3" class="item "><h3><span>·</span><a href="http://www.open-open.com/lib/list/57">网站系统</a></h3><div id="submenu3" class="item-list clearfix"><div class=" subitem"><a href="http://www.open-open.com/lib/list/58">论坛系统BBS</a><a href="http://www.open-open.com/lib/list/59">建站系统CMS</a><a href="http://www.open-open.com/lib/list/60">电子商务/商城</a><a href="http://www.open-open.com/lib/list/61">SNS社交网络/交友平台</a><a href="http://www.open-open.com/lib/list/62">百科系统Wiki</a><a href="http://www.open-open.com/lib/list/63">门户平台Portal</a><a href="http://www.open-open.com/lib/list/64">网络会议/视频会议</a><a href="http://www.open-open.com/lib/list/65">相册/照片/多媒体系统</a><a href="http://www.open-open.com/lib/list/66">微博工具/系统</a><a href="http://www.open-open.com/lib/list/363">博客系统</a><a href="http://www.open-open.com/lib/list/379">开源问答系统</a></div><div class="cat-right"></div></div></div><div data-submenu-id="submenu4" class="item "><h3><span>·</span><a href="http://www.open-open.com/lib/list/67">企业应用</a></h3><div id="submenu4" class="item-list clearfix"><div class=" subitem"><a href="http://www.open-open.com/lib/list/68">ERP/CRM</a><a href="http://www.open-open.com/lib/list/69">OA办公/协作平台</a><a href="http://www.open-open.com/lib/list/70">WebMail系统</a><a href="http://www.open-open.com/lib/list/71">地理信息系统GIS</a><a href="http://www.open-open.com/lib/list/72">数据挖掘</a><a href="http://www.open-open.com/lib/list/73">文档管理</a><a href="http://www.open-open.com/lib/list/74">项目/任务管理</a><a href="http://www.open-open.com/lib/list/333">教学科研相关</a><a href="http://www.open-open.com/lib/list/357">开源SIP项目</a><a href="http://www.open-open.com/lib/list/368">计算机辅助设计CAD/CAM</a></div><div class="cat-right"></div></div></div><div data-submenu-id="submenu5" class="item "><h3><span>·</span><a href="http://www.open-open.com/lib/list/75">服务器软件</a></h3><div id="submenu5" class="item-list clearfix"><div class=" subitem"><a href="http://www.open-open.com/lib/list/76">应用服务器</a><a href="http://www.open-open.com/lib/list/77">Web服务器</a><a href="http://www.open-open.com/lib/list/78">FTP服务器</a><a href="http://www.open-open.com/lib/list/79">邮件服务器</a><a href="http://www.open-open.com/lib/list/80">缓存服务器</a><a href="http://www.open-open.com/lib/list/81">版本控制系统</a><a href="http://www.open-open.com/lib/list/82">路由器/防火墙</a><a href="http://www.open-open.com/lib/list/83">电话/通讯/IM聊天</a><a href="http://www.open-open.com/lib/list/84">集群/负载均衡</a><a href="http://www.open-open.com/lib/list/85">流媒体服务器</a><a href="http://www.open-open.com/lib/list/86">消息系统</a><a href="http://www.open-open.com/lib/list/220">分布式/云计算/大数据</a><a href="http://www.open-open.com/lib/list/298">企业服务总线ESB</a><a href="http://www.open-open.com/lib/list/321">建站服务器套件</a><a href="http://www.open-open.com/lib/list/348">虚拟化</a><a href="http://www.open-open.com/lib/list/355">目录服务LDAP</a><a href="http://www.open-open.com/lib/list/393">容器系统</a></div><div class="cat-right"></div></div></div><div data-submenu-id="submenu6" class="item "><h3><span>·</span><a href="http://www.open-open.com/lib/list/87">插件和扩展</a></h3><div id="submenu6" class="item-list clearfix"><div class=" subitem"><a href="http://www.open-open.com/lib/list/88">Eclipse插件</a><a href="http://www.open-open.com/lib/list/89">jQuery插件</a><a href="http://www.open-open.com/lib/list/331">Node.js扩展</a><a href="http://www.open-open.com/lib/list/338">jQuery分页插件</a><a href="http://www.open-open.com/lib/list/346">Prototype扩展</a><a href="http://www.open-open.com/lib/list/356">Chrome插件/扩展</a></div><div class="cat-right"></div></div></div><div data-submenu-id="submenu7" class="item "><h3><span>·</span><a href="http://www.open-open.com/lib/list/90">数据库相关</a></h3><div id="submenu7" class="item-list clearfix"><div class=" subitem"><a href="http://www.open-open.com/lib/list/91">数据库服务器</a><a href="http://www.open-open.com/lib/list/92">数据库管理工具</a><a href="http://www.open-open.com/lib/list/93">数据库驱动程序</a><a href="http://www.open-open.com/lib/list/94">数据库建模</a><a href="http://www.open-open.com/lib/list/122">数据库连接池</a><a href="http://www.open-open.com/lib/list/154">SQL</a><a href="http://www.open-open.com/lib/list/307">NoSQL数据库</a></div><div class="cat-right"></div></div></div><div data-submenu-id="submenu8" class="item "><h3><span>·</span><a href="http://www.open-open.com/lib/list/155">操作系统</a></h3><div id="submenu8" class="item-list clearfix"><div class=" subitem"><a href="http://www.open-open.com/lib/list/156">Linux</a><a href="http://www.open-open.com/lib/list/182">CentOS</a><a href="http://www.open-open.com/lib/list/183">Ubuntu</a><a href="http://www.open-open.com/lib/list/224">UNIX</a><a href="http://www.open-open.com/lib/list/251">Fedora</a><a href="http://www.open-open.com/lib/list/274">FreeBSD</a><a href="http://www.open-open.com/lib/list/310">Solaris</a><a href="http://www.open-open.com/lib/list/311">openSUSE</a><a href="http://www.open-open.com/lib/list/312">Debian</a><a href="http://www.open-open.com/lib/list/313">OpenBSD</a></div><div class="cat-right"></div></div></div><div data-submenu-id="submenu9" class="item "><h3><span>·</span>其他分类</h3><div id="submenu9" class="item-list clearfix"><div class=" subitem"><p class="clearfix"><a href="http://www.open-open.com/lib/list/159" class="parent">软件开发管理<i>&gt;</i></a><a href="http://www.open-open.com/lib/list/174">敏捷开发</a><a href="http://www.open-open.com/lib/list/178">项目管理</a><a href="http://www.open-open.com/lib/list/196">软件架构</a><a href="http://www.open-open.com/lib/list/296">软件测试</a></p><p class="clearfix"><a href="http://www.open-open.com/lib/list/319" class="parent">管理和监控<i>&gt;</i></a><a href="http://www.open-open.com/lib/list/320">系统监控</a><a href="http://www.open-open.com/lib/list/360">日志分析和统计</a><a href="http://www.open-open.com/lib/list/366">备份工具</a></p><p class="clearfix"><a href="http://www.open-open.com/lib/list/322" class="parent">应用工具<i>&gt;</i></a><a href="http://www.open-open.com/lib/list/323">磁盘/光驱工具</a><a href="http://www.open-open.com/lib/list/359">文档/文本编辑</a><a href="http://www.open-open.com/lib/list/384">终端/远程登录</a></p><p class="clearfix"><a href="http://www.open-open.com/lib/list/329" class="parent">游戏相关<i>&gt;</i></a><a href="http://www.open-open.com/lib/list/330">网页游戏</a></p></div><div class="cat-right"></div></div></div></div></div>
			<ul class="nav__list">
				<li class="nav__item ">

				</li>
				<li class="nav__item"><i class="fa fa-tags"></i></li>

				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/Android" rel="tag">Android</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/IOS" rel="tag">IOS</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/JavaScript" rel="tag">JavaScript</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/HTML5" rel="tag">HTML5</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/CSS" rel="tag">CSS</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/jQuery" rel="tag">jQuery</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/Python" rel="tag">Python</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/PHP" rel="tag">PHP</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/NodeJS" rel="tag">NodeJS</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/Java" rel="tag">Java</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/Spring" rel="tag">Spring</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/MySQL" rel="tag">MySQL</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/MongoDB" rel="tag">MongoDB</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/Redis" rel="tag">Redis</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/NOSQL" rel="tag">NOSQL</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/Vim" rel="tag">Vim</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/C++" rel="tag">C++</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/C#" rel="tag">C#</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/JSON" rel="tag">JSON</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/Ruby" rel="tag">Ruby</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/Linux" rel="tag">Linux</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/Nginx" rel="tag">Nginx</a></li>
				<li class="nav__item"><a href="http://www.open-open.com/lib/tag/Docker" rel="tag">Docker</a></li>
				<li class="more"></li>

			</ul>

		</div>
	</div>
</header>



<div class="topheader" style="background: #eee;padding: 10px 0 30px;">
	<div class="container">
		<div class="row">
			<div class="col-md-9">
				<div class="crumbs">
					<a href="http://www.open-open.com/lib/list/all">所有分类</a>
					
						&nbsp;&gt;&nbsp;
						<a href="http://www.open-open.com/lib/list/75">服务器软件</a>
					
						&nbsp;&gt;&nbsp;
						<a href="http://www.open-open.com/lib/list/220">分布式/云计算/大数据</a>
					
				</div>
				<h1 id="articleTitle"> 基于ZooKeeper的分布式Session实现</h1>
				<div class="meta" style="margin-top: 10px;">
					<span id="tag-list">
					
						<a href="http://www.open-open.com/lib/tag/ZooKeeper">ZooKeeper</a>
					
					</span>&nbsp;

					<span class="item">2013-09-09 21:32:04 发布</span>
				</div>


			</div>
			<div class="col-md-3">
				<table>
					<tbody>
					<tr>
						<td><strong>您的评价</strong>:</td>
						<td>
							<div id="rate" class="rate-container"><span id="star1" class="star-big-off" title="很差">&nbsp;</span><span id="star2" class="star-big-off" title="较差">&nbsp;</span><span id="star3" class="star-big-off" title="还行">&nbsp;</span><span id="star4" class="star-big-off" title="不错">&nbsp;</span><span id="star5" class="star-big-off" title="力荐">&nbsp;</span></div>
						</td>
						<td width="30">
							<span id="score-num">5.0</span>
						</td>
						<td width="30">
							<div id="rate-tip"></div>
						</td>

					</tr>
					</tbody>
				</table>
				<div id="favorite-container"><a id="favorite" href="javascript:void(0)" class="btn btn-default">收藏</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<span class="item">13收藏</span>
					
				</div>
			</div>

		</div>
	</div>
</div>
<div class="container">
<div class="row">

		<div id="readercontainer" class="col-md-9">
				<article>
					<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">1．<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">认识<span>ZooKeeper</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">ZooKeeper</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">—— “动物园管理员”。动物园里当然有好多的动物，游客可以根据动物园提供的向导图到不同的场馆观赏各种类型的动物，而不是像走在原始丛林里，心惊胆颤的被动 物所观赏。为了让各种不同的动物呆在它们应该呆的地方，而不是相互串门，或是相互厮杀，就需要动物园管理员按照动物的各种习性加以分类和管理，这样我们才 能更加放心安全的观赏动物。回到我们企业级应用系统中，随着信息化水平的不断提高，我们的企业级系统变得越来越庞大臃肿，性能急剧下降，客户抱怨频频。拆 分系统是目前我们可选择的解决系统可伸缩性和性能问题的唯一行之有效的方法。但是拆分系统同时也带来了系统的复杂性——各子系统不是孤立存在的，它们彼此 之间需要协作和交互，这就是我们常说的分布式系统。各个子系统就好比动物园里的动物，为了使各个子系统能正常为用户提供统一的服务，必须需要一种机制来进 行协调——这就是<span>ZooKeeper</span>——动物园管理员。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">关于<span>ZooKeeper</span>更正式的介绍——<span>ZooKeeper</span>是一个为分布式应用程序提供高性能协调服务的工具集合。它可以应用在一些需要提供统一协调服务的<span>case</span>中，例如命名、配置管理、同步和组服务等。而在我们的<span>case</span>中，它被作为一个协调分布式环境中各子系统之间共享状态数据的基础设施。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">2．<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">ZooKeeper</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">之特性</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">ZooKeeper</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">本质上是一个分布式的小文件存储系统。原本是<span>Apache Hadoop</span>的一个组件，现在被拆分为一个<span>Hadoop</span>的独立子项目，在<span>HBase</span>（<span>Hadoop</span>的另外一个被拆分出来的子项目，用于分布式环境下的超大数据量的<span>DBMS</span>）中也用到了<span>ZooKeeper</span>集群。<span>ZooKeeper</span>有如下的特性：</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">1）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">简单</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">ZooKeeper</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">核心是一个精简的文件系统，它提供了一些简单的文件操作以及附加的功能，例如排序和通知。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">2）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">易表达</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">ZooKeeper</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">的数据结构原型是一棵<span>znode</span>树（类似<span>Linux</span>的文件系统），并且它们是一些已经被构建好的块，可以用来构建大型的协作数据结构和协议。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">3）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">高可用性</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">ZooKeeper</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">可以运行在一组服务器上，同时它们被设计成高可用性，为你的应用程序避免单点故障。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">4）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">松耦合交互</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">ZooKeeper</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">提供的<span>Watcher</span>机制使得各客户端与服务器的交互变得松耦合，每个客户端无需知晓其他客户端的存在，就可以和其他客户端进行数据交互。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">5）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">丰富的<span>API</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">ZooKeeper</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">为开发人员提供了一套丰富的<span>API</span>，减轻了开发人员编写通用协议的负担。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">这篇文章是关于如何在<span>ZooKeeper</span>上创建分布式<span>Session</span>系统，所以关于<span>ZooKeeper</span>的安装、使用、管理等主题不在本文的讨论范围内，如果想了解<span>ZooKeeper</span>更加详细的情况，请看另外一篇文章《<span>ZooKeeper</span>实战》。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">3．<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">为什么使用<span>ZooKeeper</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">目前有关于分布式<span>Session</span>的实现基本上都是基于<span>memcached</span>。<span>memcached</span>本质上是一个内存缓存系统。虽然<span>memcached</span>也可以是分布式集群环境的，但是对于一份数据来说，它总是存储在某一台<span>memcached</span>服务器上。如果发生网络故障或是服务器当机，则存储在这台服务器上的所有数据都将不可访问。由于数据是存储在内存中的，重启服务器，将导致数据全部丢失。当然你可以自己实现一套机制，用来在分布式<span>memcached</span>之间进行数据的同步和持久化，但是实现这套机制谈何容易！</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">由上述<span>ZooKeeper</span>的特性可知，<span>ZooKeeper</span>是一个分布式小文件系统，并且被设计为高可用性。通过选举算法和集群复制可以避免单点故障，由于是文件系统，所以即使所有的<span>ZooKeeper</span>节点全部挂掉，数据也不会丢失，重启服务器之后，数据即可恢复。另外<span>ZooKeeper</span>的节点更新是原子的，也就是说更新不是成功就是失败。通过版本号，<span>ZooKeeper</span>实现了更新的乐观锁，当版本号不相符时，则表示待更新的节点已经被其他客户端提前更新了，而当前的整个更新操作将全部失败。当然所有的一切<span>ZooKeeper</span>已经为开发者提供了保障，我们需要做的只是调用<span>API</span>。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">有人会怀疑<span>ZooKeeper</span>的执行能力，在<span>ZooKeeper</span>诞生的地方——<span>Yahoo!</span>给出了一组数据将打消你的怀疑。它的吞吐量标准已经达到大约每秒<span>10000</span>基于写操作的工作量。对于读操作的工作量来说，它的吞吐量标准还要高几倍。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">4．<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">实现分布式<span>Session</span>所面临的挑战</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">实现分布式<span>session</span>最大的挑战莫过于如何实现<span>session</span>在分布式系统之间的共享。在分布式环境下，每个子系统都是跨网络的独立<span>JVM</span>，在这些<span>JVM</span>之间实现共享数据的方式无非就是<span>TCP/IP</span>通讯。无论是<span>memcached</span>，还是<span>ZooKeeper</span>，底层都是基于<span>TCP/IP</span>的。所以，我认为使用何种工具实现分布式<span>Session</span>都是可行的，没有那种实现优于另外一种实现，在不同的应用场景，各有优缺点。世间万物，无十全十美，不要盲目的崇拜某种技术，唯有适合才是真理。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">1）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">Session ID</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">的共享</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">Session ID</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">是一个实例化<span>Session</span>对象的唯一标识，也是它在<span>Web</span>容器中可以被识别的唯一身份标签。<span>Jetty</span>和<span>Tomcat</span>容器会通过一个<span>Hash</span>算法，得到一个唯一的<span>ID</span>字符串，然后赋值给某个实例化的<span>Session</span>，此时，这个<span>Session</span>就可以被放入<span>Web</span>容器的<span>SessionManager</span>中开始它短暂的一生。在<span>Servlet</span>中，我们可以通过<span>HttpSession</span>的<span>getId()</span>方法得到这个值，但是我们无法改变这个值。当<span>Session</span>走到它一生尽头的时候，<span>Web</span>容器的<span>SessionManager</span>会根据这个<span>ID</span>将其“火化”。所以<span>Session ID</span>是非常重要的一个属性，并且要保证它的唯一性。在单系统中，<span>Session ID</span>只需要被自身的<span>Web</span>容器读写，但是在分布式环境中，多个<span>Web</span>容器需要共享同一个<span>Session ID</span>。因此，当某个子系统的<span>Web</span>容器产生一个新的<span>ID</span>时，它必须需要一种机制来通知其他子系统，并且告知新<span>ID</span>是什么。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">2）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">Session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">中数据的复制</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">和共享<span>Session ID</span>的问题一样，在分布式环境下，<span>Session</span>中的用户数据也需要在各个子系统中共享。当用户通过<span>HttpSession</span>的<span>setAttribute()</span>方法在<span>Session</span>中设置了一个用户数据时，它只存在于当前与用户交互的那个<span>Web</span>容器中，而对其他子系统的<span>Web</span>容器来说，这些数据是不可见的。当用户在下一步跳转到另外一个<span>Web</span>容器时，则又会创建一个新的<span>Session</span>对象，而此<span>Session</span>中并不包含上一步骤用户设置的数据。其实<span>Session</span>在分布式系统之间的复制实现是简单的，但是每次在<span>Session</span>数据发生变化时，都在子系统之间复制一次数据，会大大降低用户的响应速度。因此我们需要一种机制，即可以保证<span>Session</span>数据的一致性，又不会降低用户操作的响应度。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">3）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">Session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">的失效</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">Session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">是有生命周期的，当<span>Session</span>的空闲时间<span>(maxIdle</span>属性值<span>)</span>超出限制时，<span>Session</span>就失效了，这种设计主要是考虑到了<span>Web</span>容器的可靠性。当一个系统有上万人使用时，就会产生上万个<span>Session</span>对象，由于<span>HTTP</span>的无状态特性，服务器无法确切的知道用户是否真的离开了系统。因此如果没有失效机制，所有被<span>Session</span>占据的内存资源将永远无法被释放，直到系统崩溃为止。在分布式环境下，<span>Session</span>被简单的创建，并且通过某种机制被复制到了其他系统中。你无法保证每个子系统的时钟都是一致的，可能相差几秒，甚至相差几分钟。当某个<span>Web</span>容器的<span>Session</span>失效时，可能其他的子系统中的<span>Session</span>并未失效，这时会产生一个有趣的现象，一个用户在各个子系统之间跳转时，有时会提示<span>Session</span>超时，而有时又能正常操作。因此我们需要一种机制，当某个系统的<span>Session</span>失效时，其他所有系统的与之相关联的<span>Session</span>也要同步失效。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">4）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">类装载问题</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">在单系统环境下，所有类被装载到“同一个”<span>ClassLoader</span>中。我在同一个上打了引号，因为实际上并非是同一个<span>ClassLoader</span>，只是逻辑上我们认为是同一个。这里涉及到了<span>JVM</span>的类装载机制，由于这个主题不是本文的讨论重点，所以相关详情可以参考相关的<span>JVM</span>文档。因此即使是由<span>memcached</span>或是<span>ZooKeeper</span>返回的字节数组也可以正常的反序列化成相对应的对象类型。但是在分布式环境下，问题就变得异常的复杂。我们通过一个例子来描述这个问题。用户在某个子系统的<span>Session</span>中设置了一个<span>User</span>类型的对象，通过序列化，将<span>User</span>类型的对象转换成字节数组，并通过网络传输到了<span>memcached</span>或是<span>ZooKeeper</span>上。此时，用户跳转到了另外一个子系统上，需要通过<span>getAttribute</span>方法从<span>memcached</span>或是<span>ZooKeeper</span>上得到先前设置的那个<span>User</span>类型的对象数据。但是问题出现了，在这个子系统的<span>ClassLoader</span>中并没有装载<span>User</span>类型。因此在做反序列化时出现了<span>ClassNotFoundException</span>异常。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">当然上面描述的<span>4</span>点挑战只是在实现分布式<span>Session</span>过程中面临的关键问题，并不是全部。其实在我实现分布式<span>Session</span>的整个过程中还遇到了其他的一些挑战。比如，需要通过<span>filter</span>机制拦截<span>HttpServletRequest</span>，以便覆盖其<span>getSession</span>方法。但是在不同的<span>Web</span>容器中（例如<span>Jetty</span>或是<span>Tomcat</span>）对<span>HttpServletRequest</span>的实现是不一样的，虽然都是实现了<span>HttpServletRequest</span>接口，但是各自又添加了一些特性在其中。例如，在<span>Jetty</span>容器中，<span>HttpSession</span>的实现类是一个保护内部类，无法从其继承并覆盖相关的方法，只能从其实现类的父类中继承更加抽象的<span>Session</span>实现。这样就会造成一个问题，我必须重新实现对<span>Session</span>整个生命周期管理的<span>SessionManager</span>接口。有人会说，那就放弃它的实现吧，我们自己实现<span>HttpSession</span>接口。很不幸，那是不可能的。因为在<span>Jetty</span>的<span>HttpServletRequest</span>实现类的一些方法中对<span>Session</span>的类型进行了强制转换（转换成它自定义的<span>HttpSession</span>实现类），如果不从其继承，则会出现<span>ClassCastException</span>异常。相比之下，<span>Tomcat</span>的对<span>HttpServletRequest</span>和<span>HttpSession</span>接口的实现还是比较标准的。由此可见，实现分布式<span>Session</span>其实是和某种<span>Web</span>容器紧密耦合的。并不像网上有些人的轻描淡写，仅仅覆盖<span>setAttribute</span>和<span>getAttribute</span>方法是行不通的。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">5．<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">算法实现</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">从上述的挑战来看，要写一个分布式应用程序是困难的，主要原因是因为局部故障。由于数据需要通过网络传输，而网络是不稳定的，所以如果网络发生故障，则所有的数据通讯都将终止。<span>ZooKeeper</span>并不能解决网络故障的发生，甚至它本身也是基于网络的分布式应用程序。但是它为我们提供了一套工具集合，帮助我们建立安全处理局部故障的分布式应用程序。接下来我们就开始描述如何实现基于<span>ZooKeeper</span>的分布式<span>Session</span>系统。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">1）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">基于<span>ZooKeeper</span>的分布式<span>Session</span>系统架构</span> </p>
<p>&nbsp;<img style="cursor:pointer;" alt=" 基于ZooKeeper的分布式Session实现" src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/20130907202137_919.gif" width="451" height="360"> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">为了实现高可用性，采用了<span>ZooKeeper</span>集群，<span>ZooKeeper</span>集 群是由一台领导者服务器和若干台跟随者服务器构成（总服务器数要奇数）。所有的读操作由跟随者提供，而写操作由领导者提供，并且领导者还负责将写入的数据 复制到集群中其他的跟随者。当领导者服务器由于故障无法访问时，剩下的所有跟随者服务器就开始进行领导者的选举。通过选举算法，最终由一台原本是跟随者的 服务器升级为领导者。当然原来的领导者服务器一旦被恢复，它就只能作为跟随者服务器，并在下一次选举中争夺领导者的位置。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">Web</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">容器中的<span>Session</span>容器也将发生变化。它不再对用户的<span>Session</span>进行本地管理，而是委托给<span>ZooKeeper</span>和我们自己实现的<span>Session</span>管理器。也就是说，<span>ZooKeeper</span>负责<span>Session</span>数据的存储，而我们自己实现的<span>Session</span>管理器将负责<span>Session</span>生命周期的管理。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">最后是关于在分布式环境下共享<span>Session ID</span>的策略。我们还是通过客户端的<span>Cookie</span>来实现，我们会自定义一个<span>Cookie</span>，并通过一定的算法在多个子系统之间进行共享。下面会对此进行详细的描述。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">2）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">分布式<span>Session</span>的数据模型</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">Session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">数据的存储是有一定格式的，下图展示了一个<span>Session ID</span>为<span>”1gyh0za3qmld7”</span>的<span>Session</span>在<span>ZooKeeper</span>上的存储结构：</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;"><img style="cursor:pointer;" alt=" 基于ZooKeeper的分布式Session实现" src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/20130907202137_852.gif" width="560" height="357"></span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">“/SESSIONS”</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">是一个组节点，用来在<span>ZooKeeper</span>上划分不同功能组的定义。你可以把它理解为一个文件夹目录。在这个目录下可以存放<span>0</span>个或<span>N</span>个子节点，我们就把一个<span>Session</span>的实例作为一个节点，节点的名称就是<span>Session ID</span>。在<span>ZooKeeper</span>中，每个节点本身也可以存放一个字节数组。因此，每个节点天然就是一个<span>Key-Value</span>键值对的数据结构。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">我们将<span>Session</span>中的用户数据（本质上就是一个<span>Map</span>）设计成多节点，节点名称就是<span>Session</span>的<span>key</span>，而节点的数据就是<span>Session</span>的<span>Value</span>。采用这种设计主要是考虑到性能问题和<span>ZooKeeper</span>对节点大小的限制问题。当然，我们可以将<span>Session</span>中的用户数据保存在一个<span>Map</span>中，然后将<span>Map</span>序列化之后存储在对应的<span>Session</span>节点中。但是大部分情况下，我们在读取数据时并不需要整个<span>Map</span>，而是<span>Map</span>中的一个或几个值。这样就可以避免一个非常大的<span>Map</span>在网络间传来传去。同理，在写<span>Session</span>的时候，也可以最大限度的减少数据流量。另外由于<span>ZooKeeper</span>是一个小文件系统，为了性能，每个节点的大小为<span>1MB</span>。如果<span>Session</span>中的<span>Map</span>大于<span>1MB</span>，就不能单节点的存储了。当然，一个<span>Key</span>的数据量是很少会超过<span>1MB</span>的，如果真的超过<span>1MB</span>，你就应该考虑一下，是否应该将此数据保存在<span>Session</span>中。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">最后我们来关注一下<span>Session</span>节点中的数据——<span>SessionMetaData</span>。它是一个<span>Session</span>实例的元数据，保存了一些与<span>Session</span>生命周期控制有关的数据。以下代码就是<span>SessionMetaData</span>的实现：</span> </p>
<p><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">class</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;SessionMetaData&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">implements</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Serializable {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">final</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">long</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">serialVersionUID</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;= -6446174402446690125L;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">id</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">的创建时间<span>*/</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">createTm</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">的最大空闲时间<span>*/</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">maxIdle</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">的最后一次访问时间<span>*/</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">lastAccessTm</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">是否可用<span>*/</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Boolean&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">validate</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">当前版本<span>*/</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">int</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">version</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 0;</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">构造方法</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;SessionMetaData() {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">this</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">createTm</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;= System.<em>currentTimeMillis</em>();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">this</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">lastAccessTm</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">this</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">createTm</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">this</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">validate</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">true</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">……</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">以下是<span>N</span>多<span>getter</span>和<span>setter</span>方法</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">其中需要关注的属性有：</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">a)<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">id</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">属性：<span>Session</span>实例的<span>ID</span>。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">b)<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">maxIdle</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">属性：<span>Session</span>的最大空闲时间，默认情况下是<span>30</span>分钟。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">c)<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">lastAccessTm</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">属性：<span>Session</span>的最后一次访问时间，每次调用<span>Request.getSession</span>方法时都会去更新这个值。用来计算当前<span>Session</span>是否超时。如果<span>lastAccessTm+maxIdle</span>小于<span>System.</span></span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">currentTimeMillis</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">()</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">，就表示当前<span>Session</span>超时。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">d)<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">validate</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">属性：表示当前<span>Session</span>是否可用，如果超时，则此属性为<span>false</span>。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">e)<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">version</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">属性：这个属性是为了冗余<span>Znode</span>的<span>version</span>值，用来实现乐观锁，对<span>Session</span>节点的元数据进行更新操作。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">这里有必要提一下一个老生常谈的问题，就是所有存储在节点上的对象必须是可序列化的，也就是必须实现<span>Serializable</span>接口，否则无法保存。这个问题在<span>memcached</span>和<span>ZooKeeper</span>上都存在的。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">3）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">实现过程</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">实现分布式<span>Session</span>的第一步就是要定义一个<span>filter</span>，用来拦截<span>HttpServletRequest</span>对象。以下代码片段，展现了在<span>Jetty</span>容器下的<span>filter</span>实现。</span> </p>
<p><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">class</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;JettyDistributedSessionFilter&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">extends</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;DistributedSessionFilter {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Logger&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;= Logger.<em>getLogger</em>(getClass());</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#646464;font-size:9pt;">@Override</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;init(FilterConfig filterConfig)&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">throws</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;ServletException {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">super</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.init(filterConfig);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">实例化<span style="text-decoration:underline;"><span>Jetty</span></span>容器下的<span>Session</span>管理器</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;JettyDistributedSessionManager(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">conf</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.start();&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">启动初始化</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">创建组节点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeperHelper.<em>createGroupNode</em>();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.debug(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"DistributedSessionFilter.init completed."</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(Exception e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#646464;font-size:9pt;">@Override</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;doFilter(ServletRequest request, ServletResponse response, FilterChain chain)</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">throws</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;IOException,</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServletException {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;<span style="text-decoration:underline;">Jetty</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">容器的<span>Request</span>对象包装器，用于重写<span>Session</span>的相关操作</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JettyRequestWrapper req =&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;JettyRequestWrapper(request,&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain.doFilter(req, response);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">这个<span>filter</span>是继承自<span>DistributedSessionFilter</span>的，这个父类主要是负责完成初始化参数设置等通用方法的实现，代码如下所示：</span> </p>
<p><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">abstract</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">class</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;DistributedSessionFilter&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">implements</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Filter {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">protected</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Logger&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= Logger.<em>getLogger</em>(getClass());</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">参数配置<span>*/</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">protected</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Configuration&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">conf</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**Session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">管理器<span>*/</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">protected</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;SessionManager&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">初始化参数名称<span>*/</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">final</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">SERVERS</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;=&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"servers"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">final</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">TIMEOUT</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;=&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"timeout"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">final</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">POOLSIZE</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;=&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"poolsize"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">初始化</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@see</span> &nbsp;</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;javax.servlet.Filter#init(javax.servlet.FilterConfig)</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#646464;font-size:9pt;">@Override</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;init(FilterConfig filterConfig)&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">throws</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;ServletException {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">conf</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Configuration();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String servers = filterConfig.getInitParameter(</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">SERVERS</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(StringUtils.<em>isNotBlank</em>(servers)) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">conf</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.setServers(servers);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String timeout = filterConfig.getInitParameter(</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">TIMEOUT</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(StringUtils.<em>isNotBlank</em>(timeout)) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">conf</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.setTimeout(Long.<em>valueOf</em>(timeout));</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(NumberFormatException ex) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"timeout parse error["</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ timeout +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]."</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String poolsize = filterConfig.getInitParameter(</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">POOLSIZE</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(StringUtils.<em>isNotBlank</em>(poolsize)) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">conf</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.setPoolSize(Integer.<em>valueOf</em>(poolsize));</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(NumberFormatException ex) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"poolsize parse error["</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ poolsize +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]."</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">初始化<span>ZooKeeper</span>配置参数</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeperHelper.<em>initialize</em>(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">conf</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">销毁</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@see</span> &nbsp;</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;javax.servlet.Filter#destroy()</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#646464;font-size:9pt;">@Override</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;destroy() {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;!=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.stop();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(Exception e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">销毁<span>ZooKeeper</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeperHelper.<em>destroy</em>();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.debug(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"DistributedSessionFilter.destroy completed."</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">在<span>filter</span>中需要关注的重点是<span>doFilter</span>方法。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#646464;font-size:9pt;">@Override</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;doFilter(ServletRequest request, ServletResponse response, FilterChain chain)</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">throws</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;IOException,</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServletException {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;<span style="text-decoration:underline;">Jetty</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">容器的<span>Request</span>对象包装器，用于重写<span>Session</span>的相关操作</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JettyRequestWrapper req =&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;JettyRequestWrapper(request,&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain.doFilter(req, response);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">这里实例化了一个包装器（装饰者模式）类，用来包装<span>Jetty</span>容器的<span>Request</span>对象，并覆盖其<span>getSession</span>方法。<span>&nbsp;</span>另外我们还自己实现<span>sessionManager</span>接口，用来管理<span>Session</span>的生命周期。通过<span>filter</span>机制，我们就接管了<span>Session</span>的整个生命周期的管理权。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">接下来我们来看看，<span>Request</span>包装器是如何重写<span>getSession</span>方法，替换成使用<span>ZooKeeper</span>上的<span>Session</span>数据。关键代码如下所示：</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#646464;font-size:9pt;">@Override</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;HttpSession getSession(</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">boolean</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;create) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">检查<span>Session</span>管理器</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;==&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&amp;&amp; create) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">throw</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;IllegalStateException(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"No SessionHandler or SessionManager"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;!=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&amp;&amp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;!=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">从客户端<span>cookie</span>中查找<span>Session ID</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String id =&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.getRequestSessionId(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">request</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.debug(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">获取客户端的<span>Session ID:["</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ id +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(id !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&amp;&amp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;!=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">如果存在，则先从管理器中取</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;=&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.getHttpSession(id,&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">request</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;==&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&amp;&amp; !create) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">否则实例化一个新的<span>Session</span>对象</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;==&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&amp;&amp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;!=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&amp;&amp; create) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;=&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessionManager</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.newHttpSession(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">request</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">其实实现很简单，大部分工作都委托给了<span>sessionManager</span>来处理。因此，还是让我们来关注<span>sessionManager</span>的相关方法实现。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">A）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">获取<span>Session ID:</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#646464;font-size:9pt;">@Override</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String&nbsp;<span style="background-color:silver;">getRequestSessionId</span>(HttpServletRequest request) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;CookieHelper.<em>findSessionId</em>(request);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">这个方法就是从客户端的<span>Cookies</span>中查找我们的一个自定义的<span>Cookie</span>值，这个<span>Cookie</span>的名称为：<span>”DISTRIBUTED_SESSION_ID”(Web</span>容器自己也在<span>Cookie</span>中写了一个值，用来在不同的<span>request</span>中传递<span>Session ID</span>，这个<span>Cookie</span>的名称叫“<span>JSESSIONID</span>”<span>)</span>。如果返回<span>null</span>，则表示客户端从来都没有创建过<span>Session</span>实例。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">B）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">如果返回的<span>Cookie</span>值不为<span>null</span>，则有<span>3</span>种可能性：其一，已经实例化过一个<span>Session</span>对象并且可以正常使用；其二，虽然已经实例化过了，但是可能此<span>Session</span>已经超时失效；其三，分布式环境中的其他子系统已经实例化过了，但是本系统中还未实例化过此<span>Session</span>对象。所以先要对已经存在的<span>Session ID</span>进行处理。关键代码如下：</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#646464;font-size:9pt;">@Override</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;HttpSession getHttpSession(String id, HttpServletRequest request) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">类型检查</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(!(request&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">instanceof</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Request)) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.warn(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">不是<span>Jetty</span>容器下的<span>Request</span>对象<span>"</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">将<span>HttpServletRequest</span>转换成<span style="text-decoration:underline;"><span>Jetty</span></span>容器的<span>Request</span>类型</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request req = (Request) request;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//ZooKeeper</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">服务器上查找指定节点是否有效</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">boolean</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;valid = ZooKeeperHelper.<em>isValid</em>(id);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">如果为<span>false</span>，表示服务器上无该<span>Session</span>节点，需要重新创建<span>(</span>返回<span>null)</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(!valid) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">删除本地的副本</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessions</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.remove(id);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">else</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">更新<span>Session</span>节点的元数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeperHelper.<em>updateSessionMetaData</em>(id);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpSession session =&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessions</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.get(id);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">如果存在，则直接返回</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(session !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;session;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">否则创建指定<span>ID</span>的<span>Session</span>并返回<span>(</span>用于同步分布式环境中的其他机器上的<span>Session</span>本地副本<span>)</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session =&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;JettyDistributedSession((AbstractSessionManager) req.getSessionManager(),</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.<em>currentTimeMillis</em>(), id);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">sessions</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.put(id, session);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;session;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">首先根据<span>ID</span>去<span>ZooKeeper</span>上验证此<span>Session</span>是否有效，如果无效了，则直接返回<span>null</span>，表示此<span>Session</span>已经超时不可用，同时需要删除本地的“影子”<span>Session</span>对象（不管存在与否）。如果该节点有效，则首先更新该<span>Session</span>节点的元数据（例如，最后一次访问时间）。然后先到本地的<span>Session</span>容器中查找是否存在该<span>ID</span>的<span>Session</span>对象。本地<span>Session</span>容器中的<span>Session</span>对象并不用来保存用户数据，也不进行生命周期管理，纯粹为了在不同请求中进行传递。唯一有价值的就<span>Session ID</span>，因此，我喜欢把本地<span>Session</span>容器中的<span>Session</span>对象称为“影子”<span>Session</span>，它只是<span>ZooKeeper</span>上真正<span>Session</span>的一个影子而已。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">如果<span>Session</span>节点没有失效，但是本地<span>Session</span>容器并没有指定<span>ID</span>的<span>”</span>影子<span>”Session</span>，则表示是第三种可能性，需要进行影子<span>Session</span>的同步。正如代码中所展示的，我们实例化一个指定<span>ID</span>的<span>Session</span>对象，并放入当前系统的<span>Session</span>容器中，这样就完成了<span>Session ID</span>在分布式环境中的共享，以及<span>Session</span>对象在各子系统之间的同步。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">C）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">如果通过上面的方法返回的<span>Session</span>对象还是<span>null</span>，则真的需要实例化一个<span>Session</span>对象了，代码如下所示：</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;HttpSession newHttpSession(HttpServletRequest request) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">类型检查</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(!(request&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">instanceof</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Request)) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.warn(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">不是<span>Jetty</span>容器下的<span>Request</span>对象<span>"</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">将<span>HttpServletRequest</span>转换成<span style="text-decoration:underline;"><span>Jetty</span></span>容器的<span>Request</span>类型</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request req = (Request) request;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Session session =&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;JettyDistributedSession(</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(AbstractSessionManager) req.getSessionManager(), request);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addHttpSession(session, request);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String id = session.getId();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">写<span>cookie</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cookie cookie = CookieHelper.<em>writeSessionIdToCookie</em>(id, req, req.getConnection()</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.getResponse());</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(cookie !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.debug(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"Wrote sid to Cookie,name:["</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ cookie.getName() +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"],value:["</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ cookie.getValue() +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">在<span>ZooKeeper</span>服务器上创建<span>session</span>节点，节点名称为<span>Session ID</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">创建元数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SessionMetaData metadata =&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;SessionMetaData();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;metadata.setId(id);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;metadata.setMaxIdle(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">config</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.getTimeout() * 60 * 1000);&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">转换成毫秒</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeperHelper.<em>createSessionNode</em>(metadata);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;session;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">以上代码会实例化一个<span>Session</span>对象，并将<span>Session ID</span>写入客户端<span>Cookie</span>中，最后实例化<span>Session</span>元数据，并在<span>ZooKeeper</span>上新建一个<span>Session</span>节点。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">通过上面步骤，我们就将<span>Session</span>的整个生命周期管理与<span>ZooKeeper</span>关联起来了。接下来我们看看<span>Session</span>对象的几个重要方法的重写：</span> </p>
<p><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">synchronized</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Object getAttribute(String name) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">获取<span>session ID</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String id = getId();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(StringUtils.<em>isNotBlank</em>(id)) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">返回<span>Session</span>节点下的数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;ZooKeeperHelper.<em>getSessionData</em>(id, name);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">synchronized</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;removeAttribute(String name) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">获取<span>session ID</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String id = getId();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(StringUtils.<em>isNotBlank</em>(id)) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">删除<span>Session</span>节点下的数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeperHelper.<em>removeSessionData</em>(id, name);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">synchronized</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;setAttribute(String name, Object value) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">获取<span>session ID</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String id = getId();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(StringUtils.<em>isNotBlank</em>(id)) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">将数据添加到<span>ZooKeeper</span>服务器上</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeperHelper.<em>setSessionData</em>(id, name, value);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;invalidate()&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">throws</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;IllegalStateException {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">获取<span>session ID</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String id = getId();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(StringUtils.<em>isNotBlank</em>(id)) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">删除<span>Session</span>节点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeperHelper.<em>deleteSessionNode</em>(id);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">这些方法中都是直接和<span>ZooKeeper</span>上对应的<span>Session</span>进行数据交换。本来我是想在本地<span>Session</span>对象上创建一个<span>ZooKeeper</span>的缓冲，当用户调用<span>Session</span>的读方法时，先到本地缓冲中读数据，读不到再到<span>ZooKeeper</span>上去取，这样可以减少网络的通讯开销。但在分布式环境下，这种策略所带来的数据同步开销更加的可观。因为每次一个子系统的<span>Session</span>数据更新，都将触发所有其他子系统与之关联的<span>Session</span>数据同步操作，否则<span>Session</span>中数据的一致性将无法得到保障。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">看到这里，大家可能已经发觉了，所有与<span>ZooKeeper</span>交互的代码都被封装到<span>ZooKeeperHelper</span>类中，接下来就来看看这个类的实现。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">4）<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">ZooKeeperHelper</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">类实现</span> </p>
<p><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">class</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;ZooKeeperHelper {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">日志<span>&nbsp;*/</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Logger&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=Logger.<em>getLogger</em>(ZooKeeperHelper.</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">class</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">hosts</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;ExecutorService&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">pool</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= Executors.<em>newCachedThreadPool</em>();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">final</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">GROUP_NAME</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;=&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/SESSIONS"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">初始化</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;initialize(Configuration config) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">hosts</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;= config.getServers();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">销毁</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;destroy() {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">pool</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;!=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">关闭</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">pool</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.shutdown();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">连接服务器</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;ZooKeeper connect() {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConnectionWatcher cw =&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;ConnectionWatcher();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeper zk = cw.connection(</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">hosts</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;zk;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">关闭一个会话</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;close(ZooKeeper zk) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(zk !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zk.close();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(InterruptedException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">验证指定<span>ID</span>的节点是否有效</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;id</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">boolean</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;isValid(String id) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeper zk =&nbsp;<em>connect</em>();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(zk !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;<em>isValid</em>(id, zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">finally</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>close</em>(zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">验证指定<span>ID</span>的节点是否有效</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;id</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;zk</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">boolean</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;isValid(String id, ZooKeeper zk) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(zk !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">获取元数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SessionMetaData metadata =&nbsp;<em>getSessionMetaData</em>(id, zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">如果不存在或是无效，则直接返回<span>null</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(metadata ==&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;metadata.getValidate();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">返回指定<span>ID</span>的<span>Session</span>元数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;id</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;SessionMetaData getSessionMetaData(String id, ZooKeeper zk) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(zk !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String path =&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">GROUP_NAME</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ id;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">检查节点是否存在</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stat stat = zk.exists(path,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//<span style="text-decoration:underline;">stat</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">为<span>null</span>表示无此节点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(stat ==&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">获取节点上的数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">byte</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">[] data = zk.getData(path,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(data !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">反序列化</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object obj = SerializationUtils.<em>deserialize</em>(data);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">转换类型</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(obj&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">instanceof</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;SessionMetaData) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SessionMetaData metadata = (SessionMetaData) obj;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">设置当前版本号</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;metadata.setVersion(stat.getVersion());</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;metadata;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(KeeperException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(InterruptedException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">更新<span>Session</span>节点的元数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;id Session ID</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;version&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">更新版本号</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;zk</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;updateSessionMetaData(String id) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeper zk =&nbsp;<em>connect</em>();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">获取元数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SessionMetaData metadata =&nbsp;<em>getSessionMetaData</em>(id, zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(metadata !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>updateSessionMetaData</em>(metadata, zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">finally</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>close</em>(zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">更新<span>Session</span>节点的元数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;id Session ID</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;version&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">更新版本号</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;zk</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;updateSessionMetaData(SessionMetaData metadata, ZooKeeper zk) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(metadata !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String id = metadata.getId();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Long now = System.<em>currentTimeMillis</em>();&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">当前时间</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">检查是否过期</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Long timeout = metadata.getLastAccessTm() + metadata.getMaxIdle();&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">空闲时间</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">如果空闲时间小于当前时间，则表示<span>Session</span>超时</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(timeout &lt; now) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;metadata.setValidate(</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.debug(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"Session</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">节点已超时<span>["</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ id +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">设置最后一次访问时间</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;metadata.setLastAccessTm(now);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">更新节点数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String path =&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">GROUP_NAME</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ id;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">byte</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">[] data = SerializationUtils.<em>serialize</em>(metadata);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zk.setData(path, data, metadata.getVersion());</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.debug(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">更新<span>Session</span>节点的元数据完成<span>["</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ path +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(KeeperException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(InterruptedException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">返回<span>ZooKeeper</span>服务器上的<span>Session</span>节点的所有数据，并装载为<span>Map</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;id</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Map<string, object=""> getSessionMap(String id) {</string,></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeper zk =&nbsp;<em>connect</em>();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(zk !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String path =&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">GROUP_NAME</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ id;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">获取元数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SessionMetaData metadata =&nbsp;<em>getSessionMetaData</em>(path, zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">如果不存在或是无效，则直接返回<span>null</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(metadata ==&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;|| !metadata.getValidate()) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">获取所有子节点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List<string> nodes = zk.getChildren(path,&nbsp;</string></span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">存放数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map<string, object=""> sessionMap =&nbsp;</string,></span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;HashMap<string, object="">();</string,></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">for</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(String node : nodes) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String dataPath = path +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ node;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stat stat = zk.exists(dataPath,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">节点存在</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(stat !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">提取数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">byte</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">[] data = zk.getData(dataPath,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(data !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionMap.put(node, SerializationUtils.<em>deserialize</em>(data));</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">else</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessionMap.put(node,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;sessionMap;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(KeeperException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(InterruptedException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">finally</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>close</em>(zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">创建一个组节点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;createGroupNode() {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeper zk =&nbsp;<em>connect</em>();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(zk !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">检查节点是否存在</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stat stat = zk.exists(</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">GROUP_NAME</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//<span style="text-decoration:underline;">stat</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">为<span>null</span>表示无此节点，需要创建</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(stat ==&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">创建组件点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String createPath = zk.create(</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">GROUP_NAME</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">, Ids.</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">OPEN_ACL_UNSAFE</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">,</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateMode.</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">PERSISTENT</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.debug(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">创建节点完成<span>:["</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ createPath +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">else</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.debug(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">组节点已存在，无需创建<span>["</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">GROUP_NAME</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(KeeperException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(InterruptedException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">finally</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>close</em>(zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">创建指定<span>Session ID</span>的节点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;sid Session ID</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String createSessionNode(SessionMetaData metadata) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(metadata ==&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeper zk =&nbsp;<em>connect</em>();&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">连接服务期</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(zk !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String path =&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">GROUP_NAME</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ metadata.getId();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">检查节点是否存在</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stat stat = zk.exists(path,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//<span style="text-decoration:underline;">stat</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">为<span>null</span>表示无此节点，需要创建</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(stat ==&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">创建组件点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String createPath = zk.create(path,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">, Ids.</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">OPEN_ACL_UNSAFE</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">,</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateMode.</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">PERSISTENT</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.debug(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">创建<span>Session</span>节点完成<span>:["</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ createPath +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">写入节点数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zk.setData(path, SerializationUtils.<em>serialize</em>(metadata), -1);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;createPath;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(KeeperException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(InterruptedException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">finally</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>close</em>(zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">创建指定<span>Session ID</span>的节点<span>(</span>异步操作<span>)</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;sid</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;waitFor&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">是否等待执行结果</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String asynCreateSessionNode(</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">final</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;SessionMetaData metadata,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">boolean</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;waitFor) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callable<string> task =&nbsp;</string></span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Callable<string>() {</string></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#646464;font-size:9pt;">@Override</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String call()&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">throws</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Exception {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;<em>createSessionNode</em>(metadata);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Future<string> result =&nbsp;</string></span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">pool</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.submit(task);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">如果需要等待执行结果</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(waitFor) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">while</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">true</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(result.isDone()) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;result.get();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(Exception e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">删除指定<span>Session ID</span>的节点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;sid Session ID</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">boolean</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;deleteSessionNode(String sid) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeper zk =&nbsp;<em>connect</em>();&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">连接服务期</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(zk !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String path =&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">GROUP_NAME</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ sid;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">检查节点是否存在</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stat stat = zk.exists(path,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">如果节点存在则删除之</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(stat !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">先删除子节点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List<string> nodes = zk.getChildren(path,&nbsp;</string></span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(nodes !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">for</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(String node : nodes) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zk.delete(path +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ node, -1);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">删除父节点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zk.delete(path, -1);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.debug(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">删除<span>Session</span>节点完成<span>:["</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ path +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">true</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(KeeperException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(InterruptedException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">finally</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>close</em>(zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">删除指定<span>Session ID</span>的节点<span>(</span>异步操作<span>)</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;sid</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;waitFor&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">是否等待执行结果</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">boolean</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;asynDeleteSessionNode(</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">final</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String sid,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">boolean</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;waitFor) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callable<boolean> task =&nbsp;</boolean></span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Callable<boolean>() {</boolean></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#646464;font-size:9pt;">@Override</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Boolean call()&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">throws</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Exception {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;<em>deleteSessionNode</em>(sid);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Future<boolean> result =&nbsp;</boolean></span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">pool</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.submit(task);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">如果需要等待执行结果</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(waitFor) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">while</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">true</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(result.isDone()) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;result.get();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(Exception e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">在指定<span>Session ID</span>的节点下添加数据节点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;sid Session ID</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;name&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">数据节点的名称</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;value&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">boolean</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;setSessionData(String sid, String name, Object value) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">boolean</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;result =&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeper zk =&nbsp;<em>connect</em>();&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">连接服务器</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(zk !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String path =&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">GROUP_NAME</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ sid;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">检查指定的<span>Session</span>节点是否存在</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stat stat = zk.exists(path,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">如果节点存在则删除之</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(stat !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">查找数据节点是否存在，不存在就创建一个</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String dataPath = path +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ name;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stat = zk.exists(dataPath,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(stat ==&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">创建数据节点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zk.create(dataPath,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">, Ids.</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">OPEN_ACL_UNSAFE</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">, CreateMode.</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">PERSISTENT</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.debug(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">创建数据节点完成<span>["</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ dataPath +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">在节点上设置数据，所有数据必须可序列化</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(value&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">instanceof</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Serializable) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">int</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;dataNodeVer = -1;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(stat !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">记录数据节点的版本</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataNodeVer = stat.getVersion();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">byte</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">[] data = SerializationUtils.<em>serialize</em>((Serializable) value);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stat = zk.setData(dataPath, data, dataNodeVer);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.debug(</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">更新数据节点数据完成<span>["</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ dataPath +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]["</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ value +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"]"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result =&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">true</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(KeeperException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(InterruptedException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">finally</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>close</em>(zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;result;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">删除指定<span>Session ID</span>的节点<span>(</span>异步操作<span>)</span></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;sid</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;waitFor&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">是否等待执行结果</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">boolean</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;asynSetSessionData(</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">final</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String sid,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">final</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;String name,</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">final</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Object value,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">boolean</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;waitFor) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Callable<boolean> task =&nbsp;</boolean></span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Callable<boolean>() {</boolean></span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#646464;font-size:9pt;">@Override</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Boolean call()&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">throws</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Exception {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;<em>setSessionData</em>(sid, name, value);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Future<boolean> result =&nbsp;</boolean></span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">pool</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.submit(task);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">如果需要等待执行结果</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(waitFor) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">while</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">true</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(result.isDone()) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;result.get();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(Exception e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">返回指定<span>Session ID</span>的节点下数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;sid Session ID</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;name&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">数据节点的名称</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;value&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Object getSessionData(String sid, String name) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeper zk =&nbsp;<em>connect</em>();&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">连接服务器</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(zk !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String path =&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">GROUP_NAME</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ sid;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">检查指定的<span>Session</span>节点是否存在</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stat stat = zk.exists(path,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(stat !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">查找数据节点是否存在</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String dataPath = path +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ name;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stat = zk.exists(dataPath,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object obj =&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(stat !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">获取节点数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">byte</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">[] data = zk.getData(dataPath,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(data !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">反序列化</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obj = SerializationUtils.<em>deserialize</em>(data);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;obj;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(KeeperException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(InterruptedException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">finally</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>close</em>(zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">删除指定<span>Session ID</span>的节点下数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;sid Session ID</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;name&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">数据节点的名称</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;">@param</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;value&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">数据</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@return</span> </span></strong></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;removeSessionData(String sid, String name) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeper zk =&nbsp;<em>connect</em>();&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">连接服务器</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(zk !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String path =&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">GROUP_NAME</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ sid;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">检查指定的<span>Session</span>节点是否存在</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stat stat = zk.exists(path,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(stat !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">查找数据节点是否存在</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String dataPath = path +&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#2a00ff;font-size:9pt;">"/"</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;+ name;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stat = zk.exists(dataPath,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">false</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(stat !=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">//</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">删除节点</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zk.delete(dataPath, -1);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(KeeperException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(InterruptedException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">finally</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>close</em>(zk);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">从这个类的实现中我们可以发现，与<span>ZooKeeper</span>交互的<span>API</span>非常的友好，基本上就是对文件系统的管理——创建文件、删除文件、检查文件是否存在，更新文件等等。并且对节点的查找就是对文件绝对路径的搜索，效率非常的高。例如，用户调用<span>Session</span>的<span>getAttribute(String key)</span>方法，则根据当前<span>Session</span>可以拼装成一个搜索节点的路径：<span>/SESSIONS/<session>/<key></key></session></span>。这样可以快速的定位，并获取该节点的数据。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">另外，在这个类中，我还实现类一些操作的异步版本。原来是想为了提高用户响应度，在创建、修改<span>Session</span>节点的时候使用异步调用，但是实际测试下来还是有问题的。所以目前放弃了所有操作的异步版本。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">最后让我们来看看连接<span>ZooKeeper</span>服务器的实现类，代码如下所示：</span> </p>
<p><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">class</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;ConnectionWatcher&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">implements</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Watcher {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">static</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">final</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">int</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">SESSION_TIMEOUT</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;= 5000;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;CountDownLatch&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">signal</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;=&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;CountDownLatch(1);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">private</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;Logger&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;= Logger.<em>getLogger</em>(getClass());</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">/**</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@throws</span> </span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;IOException</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f9fbf;font-size:9pt;"><span class="referer">@throws</span> </span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;InterruptedException</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f5fbf;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;ZooKeeper connection(String servers) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZooKeeper zk;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">try</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;{</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zk =&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">new</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;ZooKeeper(servers,&nbsp;</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">SESSION_TIMEOUT</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">,&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">this</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">signal</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.await();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;zk;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(IOException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">catch</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(InterruptedException e) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">log</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.error(e);</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">return</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">null</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">;</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">/*</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* (non-<span style="text-decoration:underline;">Javadoc</span>)</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<span class="referer">@see</span> </span></p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* org.apache.zookeeper.Watcher#process(org.apache.zookeeper.WatchedEvent)</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#3f7f5f;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">public</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">void</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;process(WatchedEvent event) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KeeperState state = event.getState();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#7f0055;font-size:9pt;">if</span></strong><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;(state == KeeperState.</span><em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">SyncConnected</span></em><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">) {</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:#0000c0;font-size:9pt;">signal</span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">.countDown();</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;color:black;font-size:9pt;">}</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">这个类需要关注的是实现<span>Watcher</span>接口，在上面描述<span>ZooKeeper</span>特性的时候曾经提到过，<span>ZooKeeper</span>通过<span>Watcher</span>机制实现客户端与服务器之间的松耦合交互，在<span>process</span>方法中，通过对各种事件的监听，可以进行异步的回调处理。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">这里的<span>SESSION_TIMEOUT</span>并不是<span>Web</span>容器中<span>Session</span>的超时。这是<span>ZooKeeper</span>对一个客户端的连接，即一个连接会话的超时设置。该值一般设置在<span>2</span>～<span>5</span>秒之间。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">6．<span style="line-height:normal;font-family:&#39;Times New Roman&#39;;font-size:7pt;">&nbsp;&nbsp;&nbsp;</span></span><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">后续</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">目前基于<span>ZooKeeper</span>的分布式<span>Session</span>系统的实现还是比较初步的。还有很多功能有待完善，比如要添加<span>Session</span>监听事件的支持、对<span>ZooKeeper</span>上被标记为不可用的<span>Session</span>节点的删除、对<span>Session</span>进行监控和管理的控制台以及非常难解决的<span>ClassLoader</span>问题等。另外，前文也提到了，分布式<span>Session</span>的实现是和某个<span>Web</span>容器紧密耦合的，这一点让我很不爽。因为需要针对不同的<span>Web</span>容器各自实现一套<span>Session</span>的管理机制。不过我相信通过良好的设计，可以实现通用的组件。目前我已经实现了在<span>Jetty</span>和<span>Tomcat</span>容器下的分布式<span>Session</span>。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">在文章的最后，我们讨论一下如何解决<span>ClassLoader</span>问题。其实，在<span>OSGi</span>框架下，这个问题并不是很麻烦。因为，我们可以将所有领域对象类打包成一个单独的<span>Bundle</span>。同时将分布式<span>Session</span>的<span>Filter</span>实现也打包成一个<span>Bundle</span>。通过动态引用的方式，就可以引入所有领域对象的类型了。但在非<span>OSGi</span>环境下，只能将领域对象的类文件在每个子系统中都包含一份来解决<span>ClassLoader</span>问题。这样会造成一个问题，就是当领域对象发生变化时，我需要重启所有的子系统，来装载更新后的领域对象类，而不像在<span>OSGi</span>下，只需要重启这个领域对象<span>Bundle</span>就可以了。</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">写这篇文章并不是想表示自己有多么的牛逼，而是对<span>Java</span>技术的一种热衷。搞技术的人唯一乐趣就是完成了自己在技术领域的自我突破。但是有时候又很困惑，人生苦短，我们这些技术人到底为了什么而存在？很矛盾，很纠结！</span> </p>
<p><span style="font-family:&#39;YaHei Consolas Hybrid&#39;;font-size:9pt;">来自：</span><a href="http://blog.csdn.net/jacktan/article/details/6112806" target="_blank">http://blog.csdn.net/jacktan/article/details/6112806</a> </p>
				</article>




		



		</div>



	<div class="col-md-3">
		<div class="bdsharebuttonbox bdshare-button-style0-16" data-bd-bind="1496207319126">
			<a href="http://www.open-open.com/lib/view/open1378556537303.html#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
			<a href="http://www.open-open.com/lib/view/open1378556537303.html#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
			<a href="http://www.open-open.com/lib/view/open1378556537303.html#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a>
			<a href="http://www.open-open.com/lib/view/open1378556537303.html#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a>
			<a href="http://www.open-open.com/lib/view/open1378556537303.html#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>

		</div>

		<div class=" side-box" style="margin-top: 20px;">
				<div class="title"><h3>同类热门经验</h3></div>
				<ol class="hot">
					
						<li>
							<a title="谷歌三大核心技术（一）Google" file="" system中文版="" href="http://www.open-open.com/lib/view/open1328763454608.html"><span class="title">谷歌三大核心技术（一）Google File System中文版 </span></a>
						</li>
					
						<li>
							<a title="Hadoop" 实战实例="" href="http://www.open-open.com/lib/view/open1328755683796.html"><span class="title">Hadoop 实战实例</span></a>
						</li>
					
						<li>
							<a title="基于ZooKeeper的分布式Session实现" href="http://www.open-open.com/lib/view/open1325412725125.html"><span class="title">基于ZooKeeper的分布式Session实现</span></a>
						</li>
					
						<li>
							<a title="谷歌三大核心技术（二）Google" mapreduce中文版="" href="http://www.open-open.com/lib/view/open1328763069203.html"><span class="title">谷歌三大核心技术（二）Google MapReduce中文版 </span></a>
						</li>
					
						<li>
							<a title="轻松使用Hadoop" rpc="" href="http://www.open-open.com/lib/view/open1325322874436.html"><span class="title">轻松使用Hadoop RPC </span></a>
						</li>
					
						<li>
							<a title="为什么Hadoop将一定会是分布式计算的未来？" href="http://www.open-open.com/lib/view/open1329629720718.html"><span class="title">为什么Hadoop将一定会是分布式计算的未来？</span></a>
						</li>
					

				</ol>
			</div>
		<p class="aiBar"></p>
		<div class="side-box post-nav" style="margin-top: 20px;">
			<div class="title"><h3>阅读目录</h3></div>
			<ul class="articleIndex"></ul>
		</div>
	</div>



</div>
	</div>

<div class="container">
<script type="text/javascript">
    var cpro_id = "u2690846";
</script>
<script type="text/javascript" src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/c.js.下载"></script><div id="BAIDU_SSP__wrapper_u2690846_0"><iframe id="iframeu2690846_0" src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/ccwm.html" width="846" height="120" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0;vertical-align:bottom;margin:0;width:846px;height:120px" allowtransparency="true"></iframe></div>

	<div class="row">
		<div class="col-md-9">
			<table width="100%"><tbody><tr>
				<td valign="top" width="33%" class="Relatedb">
					<div style="border-bottom: 1px #ccc solid;margin-top: 5px"><strong>相关文档</strong> 　—　<a href="http://www.open-open.com/doc" rel="nofollow" target="_blank">更多</a></div>
					<ul>
						
							<li><a href="http://www.open-open.com/doc/view/6c977d00ef9e427bba665d7202e0edfc" rel="nofollow" target="_blank" title="基于 ZooKeeper的配置信息存储方案的设计与实现.pdf">基于 ZooKeeper的配置信息存储方案的设计与实现.pdf</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/78cf20e8bb7e4849b2b2918e5de30bb1" rel="nofollow" target="_blank" title="zookeeper的关于分布式锁的实现.doc">zookeeper的关于分布式锁的实现.doc</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/ed08468d2b804b8d8e6b70c8dd65c6e9" rel="nofollow" target="_blank" title="使用 Zookeeper 构建 LogServer.docx">使用 Zookeeper 构建 LogServer.docx</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/35ba697ed2d2414fbc0fccb27635ba88" rel="nofollow" target="_blank" title="ZooKeeper 应用场景.docx">ZooKeeper 应用场景.docx</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/351a0c21599e4da88c4ea39302a5e3ee" rel="nofollow" target="_blank" title="ZooKeeper应用场景.docx">ZooKeeper应用场景.docx</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/bf773dadf18a40cba84e863165966e9d" rel="nofollow" target="_blank" title="ZooKeeper 典型应用场景一览.pdf">ZooKeeper 典型应用场景一览.pdf</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/21cf59788e054d3eae459524580547a3" rel="nofollow" target="_blank" title="ZooKeeper典型应用场景一览.pdf">ZooKeeper典型应用场景一览.pdf</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/7ca2862289eb4b769a32bf3a2ffc9fd2" rel="nofollow" target="_blank" title="ZooKeeper 典型应用场景一览.pdf">ZooKeeper 典型应用场景一览.pdf</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/a33648c6b0054a1b9745abc7ef2cd74d" rel="nofollow" target="_blank" title="ZooKeeper 典型应用场景一览.pdf">ZooKeeper 典型应用场景一览.pdf</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/44d3c841ac204dbda2bf61d41a0a7bff" rel="nofollow" target="_blank" title="ZooKeeper 分布式应用程序协调服务.pdf">ZooKeeper 分布式应用程序协调服务.pdf</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/0010b57e61464873ac615b2f505f0df9" rel="nofollow" target="_blank" title="ZooKeeper 简介.docx">ZooKeeper 简介.docx</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/7ffe65006844430987f72ebf59b50fb2" rel="nofollow" target="_blank" title="zookeeper知识分享.pptx">zookeeper知识分享.pptx</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/01f7415f3f2f406f9e86986f1adf61c3" rel="nofollow" target="_blank" title="zookeeper 初体验.docx">zookeeper 初体验.docx</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/4be1d743da6a4f1082d760be76647c33" rel="nofollow" target="_blank" title="ZooKeeper 系列讲座_很全面.doc">ZooKeeper 系列讲座_很全面.doc</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/24f3da3d7e3e46ed801a3fdb77baa5c4" rel="nofollow" target="_blank" title="Zookeeper 入门.doc">Zookeeper 入门.doc</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/f0d91d82ed6c4e78ac83fb2f3ad463c6" rel="nofollow" target="_blank" title="分布式服务框架 Zookeeper 管理分布式环境中的数据.doc">分布式服务框架 Zookeeper 管理分布式环境中的数据.doc</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/d6e7c25908d14007b98c0ee0f1ff9c9c" rel="nofollow" target="_blank" title="分布式服务框架 Zookeeper - 管理分布式环境中的数据.doc">分布式服务框架 Zookeeper - 管理分布式环境中的数据.doc</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/434c5807d65647e1b14e73642e4b7828" rel="nofollow" target="_blank" title="从Paxos到ZooKeeper：分布式一致性原理与实践.pdf">从Paxos到ZooKeeper：分布式一致性原理与实践.pdf</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/3a920438dc504d2aa5d04abdb5465a4f" rel="nofollow" target="_blank" title="ZooKeeper Recipes and Solutions.pdf">ZooKeeper Recipes and Solutions.pdf</a></li>
						
							<li><a href="http://www.open-open.com/doc/view/fcb34a8f3ba04d8691e7536834a73f57" rel="nofollow" target="_blank" title="ZooKeeper (2013.11) Flavio Junqueira 文字版.pdf">ZooKeeper (2013.11) Flavio Junqueira 文字版.pdf</a></li>
						
					</ul>
				</td>
				<td valign="top" width="33%" class="Relatedb">
					<div style="border-bottom: 1px #ccc solid;margin-top: 5px"><strong>相关经验</strong> 　—　<a href="http://www.open-open.com/lib" rel="nofollow" target="_blank">更多</a></div>
					<ul>
						
							<li>
								<a title="基于ZooKeeper的分布式Session实现" href="http://www.open-open.com/lib/view/open1378556537303.html" target="_blank"><span class="title"> 基于ZooKeeper的分布式Session实现</span></a>

							</li>
						
							<li>
								<a title="Zookeeper的Session" href="http://www.open-open.com/lib/view/open1451867718636.html" target="_blank"><span class="title">Zookeeper的Session</span></a>

							</li>
						
							<li>
								<a title="ZooKeeper架构设计及其应用要点" href="http://www.open-open.com/lib/view/open1436860994896.html" target="_blank"><span class="title">ZooKeeper架构设计及其应用要点</span></a>

							</li>
						
							<li>
								<a title="分布式服务框架：Zookeeper" href="http://www.open-open.com/lib/view/open1417489762015.html" target="_blank"><span class="title">分布式服务框架：Zookeeper</span></a>

							</li>
						
							<li>
								<a title="使用" rmi="" +="" zookeeper="" 实现远程调用框架="" href="http://www.open-open.com/lib/view/open1416097626352.html" target="_blank"><span class="title">使用 RMI + ZooKeeper 实现远程调用框架</span></a>

							</li>
						
							<li>
								<a title="Windows安装和使用zookeeper" href="http://www.open-open.com/lib/view/open1455716599886.html" target="_blank"><span class="title">Windows安装和使用zookeeper</span></a>

							</li>
						
							<li>
								<a title="Zookeeper研究和应用" href="http://www.open-open.com/lib/view/open1427264173699.html" target="_blank"><span class="title">Zookeeper研究和应用</span></a>

							</li>
						
							<li>
								<a title="Zookeeper的Java客户端" href="http://www.open-open.com/lib/view/open1425345434634.html" target="_blank"><span class="title">Zookeeper的Java客户端</span></a>

							</li>
						
							<li>
								<a title="分布式服务框架" zookeeper="" --="" 管理分布式环境中的数据="" href="http://www.open-open.com/lib/view/open1436603920598.html" target="_blank"><span class="title">分布式服务框架 Zookeeper -- 管理分布式环境中的数据</span></a>

							</li>
						
							<li>
								<a title="zookeeper入门与实战" href="http://www.open-open.com/lib/view/open1456154723823.html" target="_blank"><span class="title">zookeeper入门与实战  </span></a>

							</li>
						
							<li>
								<a title="Zookeeper原理" href="http://www.open-open.com/lib/view/open1428908546408.html" target="_blank"><span class="title">Zookeeper原理</span></a>

							</li>
						
							<li>
								<a title="Zookeeper原理及简介" href="http://www.open-open.com/lib/view/open1431333369935.html" target="_blank"><span class="title">Zookeeper原理及简介</span></a>

							</li>
						
							<li>
								<a title="使用" rmi="" +="" zookeeper="" 实现远程调用框架="" href="http://www.open-open.com/lib/view/open1466730836247.html" target="_blank"><span class="title">使用 RMI + ZooKeeper 实现远程调用框架</span></a>

							</li>
						
							<li>
								<a title="zookeeper简介" href="http://www.open-open.com/lib/view/open1415453633887.html" target="_blank"><span class="title">zookeeper简介</span></a>

							</li>
						
					</ul>
				</td>
				<td valign="top" width="33%" class="Relatedb">
					<div style="border-bottom: 1px #ccc solid;margin-top: 5px"><strong>相关讨论</strong> 　—　<a href="http://www.open-open.com/solution" rel="nofollow" target="_blank">更多</a></div>
					<ul>
						
							<li>
								<a title="光环国际公开课—Hadoop大数据处理技术及其实践" href="http://www.open-open.com/solution/view/1419824554140" rel="nofollow" target="_blank"><span class="title">光环国际公开课—Hadoop大数据处理技术及其实践</span></a>
							</li>
						
							<li>
								<a title="Hibernate" session方法小结="" href="http://www.open-open.com/solution/view/1320567738906" rel="nofollow" target="_blank"><span class="title">Hibernate Session方法小结</span></a>
							</li>
						
							<li>
								<a title="Windows平台分布式架构实践" -="" 负载均衡="" href="http://www.open-open.com/solution/view/1405087737029" rel="nofollow" target="_blank"><span class="title">Windows平台分布式架构实践 - 负载均衡</span></a>
							</li>
						
							<li>
								<a title="大型网站后台架构的Web" server与缓存="" href="http://www.open-open.com/solution/view/1319767005656" rel="nofollow" target="_blank"><span class="title">大型网站后台架构的Web Server与缓存</span></a>
							</li>
						
							<li>
								<a title="天猫浏览型应用的CDN静态化架构演变" href="http://www.open-open.com/solution/view/1404964984388" rel="nofollow" target="_blank"><span class="title">天猫浏览型应用的CDN静态化架构演变</span></a>
							</li>
						
							<li>
								<a title="MySQL和PostgreSQL的比较" href="http://www.open-open.com/solution/view/1324368365874" rel="nofollow" target="_blank"><span class="title">MySQL和PostgreSQL的比较</span></a>
							</li>
						
							<li>
								<a title="优秀PHP程序员应具备的5大能力" href="http://www.open-open.com/solution/view/1420697081859" rel="nofollow" target="_blank"><span class="title">优秀PHP程序员应具备的5大能力 </span></a>
							</li>
						
					</ul>
				</td>
			</tr></tbody></table>
		</div>

	</div>

</div>





<style>
	footer{background-color: #fff;
		border-top: 1px solid rgba(230, 230, 230, 0.75);
		margin-top: 20px;
		padding: 20px 0;}
</style>
<footer>
	<div class="container">
		<div class="row">
			<div class="col-md-4 col-xs-4" style="line-height: 60px;">
				<span>©2006-2016 深度开源 </span>
			</div>
			<div class="col-md-4 col-xs-4 text-center"><span>
				<a rel="nofollow" href="http://www.open-open.com/" class="brightbox-logo"><img src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/logo-icon.png"></a>
			</span></div>
			<div class="col-md-4 col-xs-4" style="line-height: 60px;">
				 <a target="_blank" href="http://www.miibeian.gov.cn/">浙ICP备09019653号-31</a>
				<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1257892335'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1257892335' type='text/javascript'%3E%3C/script%3E"));</script><span id="cnzz_stat_icon_1257892335"><a href="http://www.cnzz.com/stat/website.php?web_id=1257892335" target="_blank" title="站长统计">站长统计</a></span><script src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/z_stat.php" type="text/javascript"></script><script src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/core.php" charset="utf-8" type="text/javascript"></script>
			</div>
		</div>
	</div>
</footer>

<script src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/jquery.min.js.下载"></script>
<script type="text/javascript" src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/jquery-confirm.js.下载"></script>
<script type="text/javascript" src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/app.js.下载"></script>
<script type="text/javascript" src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/scrolltopcontrol.js.下载"></script>
<!-- the jScrollPane script -->
<script type="text/javascript" src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/jquery.contentcarousel.js.下载"></script>

<script type="text/javascript">
	var rooturl="/lib";
	var tb_pathToImage = "/lib/images/loadingAnimation.gif";
	var jc = {};
	$(function (){
		$('#ca-container').contentcarousel();
		$('.login').on('click', function () {
			jc = $.dialog({
				title: '&nbsp;',
				content: '<iframe id="dialog" scrolling="no" style="width:100%;border:none;height:300px;" src="/lib/members/login?keepThis=true&TB_iframe=true&height=177&width=280"></iframe>',
				animation: 'top',
				columnClass: 'col-md-5 col-md-offset-3',
				closeAnimation: 'top',
				backgroundDismiss: true
			});
		});
		$('.register').on('click', function () {
			jc = $.dialog({
				title: '&nbsp;',
				content: '<iframe id="dialog" scrolling="no" style="width:100%;border:none;height:460px;" src="/lib/members/register?keepThis=true&TB_iframe=true&height=460&width=460"></iframe>',
				animation: 'top',
				columnClass: 'col-md-6 col-md-offset-3',
				closeAnimation: 'top',
				backgroundDismiss: true
			});
		});


	});


</script>

<script src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/jquery-ui.min.js.下载"></script>
<script type="text/javascript" src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/scrolltopcontrol.js.下载"></script>
<script type="text/javascript" src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/view.js.下载"></script>

<script type="text/javascript" src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/jquery.jgrowl_minimized.js.下载"></script>

<script type="text/javascript">
	scrolltotop.offset(95,165);
	scrolltotop.init();
</script>
<script src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/highlight.min.js.下载"></script>
<script>hljs.initHighlightingOnLoad();

	(function(){
		var c = new contentIndex();
		c("article", ".articleIndex");
		setAIActive();


		$(window).scroll(function () {
			if ($(window).scrollTop() > $(".aiBar").offset().top) {
				$(".post-nav").addClass("aside-fixed");
//          console.log($(window).scrollTop());
			} else {
//           console.log($(window).scrollTop());
				$(".post-nav").removeClass("aside-fixed");
			}
		});
		$("#readercontainer img").each(function(index, element) {
			var $width=$("#readercontainer article").width();
			if ( this.width>$width) {

				this.height = this.height*$width/this.width;
				this.width=$width;
			}
		});

	})();
</script>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

<script>
	(function(){
		var bp = document.createElement('script');
		bp.src = '//push.zhanzhang.baidu.com/push.js';
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	})();
</script>



<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable" tabindex="-1" role="dialog" aria-describedby="favorite-box" aria-labelledby="ui-id-1" style="display: none;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix ui-draggable-handle"><span id="ui-id-1" class="ui-dialog-title">收藏提示</span><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" title="Close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">Close</span></button></div><div id="favorite-box" class="ui-dialog-content ui-widget-content" style="display: block;">
						<table>
							<tbody>
							<tr>
								<td width="70" align="right">文件夹</td>
								<td><select id="fav_folderlist" name="folder">
									<option selected="" value="0">请选择...</option>
									<option id="newfolder-sp" disabled="" value="">-------------</option>
									<option value="-1">新增文件夹...</option>
								</select></td>
							</tr>
							<tr style="display: none" id="newfolder-input">
								<td align="right">新增文件夹</td>
								<td><input id="fav_newfolder" maxlength="50" type="text" name="newfolder"></td>
							</tr>
							<tr>
								<td align="right">标签</td>
								<td><input id="fav_tags" maxlength="135" size="20" type="text" name="tags"></td>
							</tr>
							<tr>
								<td></td>
								<td colspan="2">(多个标签用逗号分隔)</td>
							</tr>
							</tbody>
						</table>
					</div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button"><span class="ui-button-text">取消</span></button><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button"><span class="ui-button-text">确认</span></button></div></div></div><div id="topcontrol" title="回到顶部" style="position: fixed; bottom: 165px; right: 95px; cursor: pointer;"><img src="./基于ZooKeeper的分布式Session实现 - OPEN 开发经验库_files/gotop.gif" style="width:35px; height:35px;"></div></body></html>